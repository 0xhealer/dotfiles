set -g default-terminal "${TERM}"
set -as terminal-features ",${TERM}:RGB"
# Allow undercurls for terminals that support them.
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
# Allow coloured undercurls for terminals that support them.
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'
# kitty graphics protocol
set -gq allow-passthrough on

set-option -g prefix C-a
unbind-key C-b
bind-key C-a send-prefix

bind a last-window

set-option -wg aggressive-resize on
set-option -sg escape-time 10
set-option  -g focus-events on
set-option  -g history-limit 100000
set-option  -g renumber-windows on

bind r source-file $XDG_CONFIG_HOME/tmux/tmux.conf \; display "Reloaded!"

set-option    -g set-titles on
set-option    -g set-titles-string '❐ #S ● #I'
set-option    -g allow-rename on
set-option    -g pane-base-index 1
set-option    -g base-index 1
set-option    -g monitor-activity on
set-option   -sg repeat-time 600
set-option    -g display-time 1000
set-option    -g status-interval 5
set-option   -wg automatic-rename on
set-option    -g automatic-rename-format '#{b:pane_current_path}'
set-option    -g monitor-activity on
set-option    -g visual-activity off
set-option -g mouse on
setw -g mode-keys vi

bind C-f command-prompt -p find-session 'switch-client -t %%' # find session
bind-key C-j display-popup -E "tmux list-sessions | sed -E 's/:.*$//' | grep -v \"^$(tmux display-message -p '#S')\$\" | fzf --reverse | xargs tmux switch-client -t"

bind '|' split-window -h -c '#{?pane_path,#{pane_path},#{pane_current_path}}'
bind - split-window -v -c '#{?pane_path,#{pane_path},#{pane_current_path}}'
unbind '"'
unbind %

bind y setw synchronize-panes
bind p previous-window
bind n next-window

bind-key d detach
bind-key C-d detach

bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' { if -F '#{pane_at_left}' '' 'select-pane -L' }
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' { if -F '#{pane_at_bottom}' '' 'select-pane -D' }
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' { if -F '#{pane_at_top}' '' 'select-pane -U' }
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' { if -F '#{pane_at_right}' '' 'select-pane -R' }

bind-key -T copy-mode-vi 'C-h' if -F '#{pane_at_left}' '' 'select-pane -L'
bind-key -T copy-mode-vi 'C-j' if -F '#{pane_at_bottom}' '' 'select-pane -D'
bind-key -T copy-mode-vi 'C-k' if -F '#{pane_at_top}' '' 'select-pane -U'
bind-key -T copy-mode-vi 'C-l' if -F '#{pane_at_right}' '' 'select-pane -R'

# -------------------------------------------------------------------
# Gruvbox Material Dark Hard Theme
# -------------------------------------------------------------------

# Base colors
set -g @gruvbox_bg      '#1d2021'
set -g @gruvbox_fg      '#d4be98'
set -g @gruvbox_red     '#ea6962'
set -g @gruvbox_green   '#a9b665'
set -g @gruvbox_yellow  '#d8a657'
set -g @gruvbox_blue    '#7daea3'
set -g @gruvbox_purple  '#d3869b'
set -g @gruvbox_aqua    '#89b482'
set -g @gruvbox_orange  '#e78a4e'
set -g @gruvbox_gray    '#928374'
set -g @gruvbox_darkgray '#282828'

# Status bar
set-option -g status on
set-option -g status-justify centre
set-option -g status-bg '#1d2021'
set-option -g status-fg '#d4be98'
set-option -g status-style "bg=#1d2021,fg=#d4be98"

# Left section
set-option -g status-left-length 40
set-option -g status-left "#[fg=#a9b665,bg=#1d2021,bold] #S #[fg=#d4be98,bg=#1d2021,nobold]"

# Right section
set-option -g status-right-length 80
set-option -g status-right "#[fg=#1d2021,bg=#a9b665]#[fg=#1d2021,bg=#a9b665,bold] %Y-%m-%d  %H:%M #[default]"

# Window tabs
setw -g window-status-format " #[fg=#7daea3,bg=#1d2021]#I:#W#[default]"
setw -g window-status-current-format "#[fg=#1d2021,bg=#a9b665,bold] #I:#W #[default]"

# Pane borders
set-option -g pane-border-style "fg=#3c3836"
set-option -g pane-active-border-style "fg=#a9b665"

# Message styling
set-option -g message-style "bg=#1d2021,fg=#a9b665"

# Command prompt
set-option -g message-command-style "bg=#1d2021,fg=#d4be98"

# Copy mode colors
set-option -g mode-style "bg=#3c3836,fg=#d4be98"

# Active window title
setw -g window-status-current-style "bg=#a9b665,fg=#1d2021,bold"

# Status bar refresh rate
set-option -g status-interval 5
